{% extends "base.html" %}

{% block title %}√âtape 2 - Choix de la Randonn√©e - RandoVanGo{% endblock %}

{% block page_content %}
<div class="main-container">
    <div class="page-header">
        <div class="hero-section">
            <img src="{{ url_for('static', filename='images/van-life-liberte.jpg') }}" alt="Planificateur Van Life"
                class="hero-background">
            <div class="hero-overlay"></div>
            <div class="hero-logo-container">
                <div class="hero-logo-white">
                    <img src="{{ url_for('static', filename='images/logo_randovango.png') }}" alt="RandoVanGo"
                        class="hero-logo-img">
                </div>
            </div>
            <div class="hero-content">
                <h1 class="hero-title">Planificateur RandoVanGo</h1>
                <p class="hero-subtitle">S√©lectionnez votre randonn√©e pr√©f√©r√©e</p>
            </div>
        </div>
    </div>

    <div class="planning-stepper">
        <div class="stepper-container">
            <div class="step completed">
                <div class="step-circle">‚úì</div>
                <div class="step-label">Ville</div>
            </div>
            <div class="step-line completed"></div>
            <div class="step active">
                <div class="step-circle">2</div>
                <div class="step-label">Randonn√©e</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">3</div>
                <div class="step-label">Nuit</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">4</div>
                <div class="step-label">Services</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">üìã</div>
                <div class="step-label">R√©sultat</div>
            </div>
        </div>
    </div>

    <div class="planning-content">
        <div class="planning-step">
            <div class="step-header">
                <h2>ü•æ Jour 1 : Choisissez votre randonn√©e</h2>
                <p>S√©lectionnez l'activit√© principale qui rythmera votre premi√®re journ√©e</p>
            </div>

            <!-- Filtres rapides -->
            <div class="hiking-filters">
                <div class="filter-group">
                    <label>Difficult√© :</label>
                    <button class="filter-btn active" data-filter="all">Toutes</button>
                    <button class="filter-btn" data-filter="facile">Facile</button>
                    <button class="filter-btn" data-filter="moyen">Moyen</button>
                    <button class="filter-btn" data-filter="difficile">Difficile</button>
                </div>
                <div class="filter-group">
                    <label>Dur√©e :</label>
                    <button class="filter-btn active" data-filter="all">Toutes</button>
                    <button class="filter-btn" data-filter="court">
                        < 2h</button>
                            <button class="filter-btn" data-filter="moyen">2-4h</button>
                            <button class="filter-btn" data-filter="long">> 4h</button>
                </div>
            </div>
            <!-- Carte interactive -->
            <div class="map-page-container" style="margin: 2rem 0;">
                <h3 class="map-title">Visualisation sur la carte</h3>
                <div id="map" style="height: 40vh; width: 100%; border-radius: 12px; box-shadow: 0 2px 8px #0002;">
                </div>
            </div>
            <!-- Liste des randonn√©es -->
            <div class="hiking-list">
                <!-- Randonn√©e 1 -->
                <div class="hiking-card" data-difficulty="facile" data-duration="moyen">
                    <div class="hiking-status">
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    <div class="hiking-info">
                        <h3>Du Minou au Mengant</h3>
                        <p class="hiking-description">Magnifique sentier c√¥tier avec vue sur l'oc√©an. Phares historiques
                            et paysages sauvages.</p>
                        <div class="hiking-stats">
                            <span class="stat">
                                <i class="fas fa-clock"></i>
                                3h30
                            </span>
                            <span class="stat">
                                <i class="fas fa-route"></i>
                                8.2 km
                            </span>
                            <span class="stat">
                                <i class="fas fa-mountain"></i>
                                +120m
                            </span>
                            <span class="stat difficulty-facile">
                                <i class="fas fa-signal"></i>
                                Facile
                            </span>
                        </div>
                    </div>
                    <div class="hiking-actions">
                        <button class="btn btn-outline" onclick="showHikingMap(1)">
                            <i class="fas fa-map"></i>
                            Voir
                        </button>
                        <button class="btn btn-primary" onclick="selectHiking(1)">
                            Choisir
                        </button>
                    </div>
                </div>

                <!-- Randonn√©e 2 -->
                <div class="hiking-card" data-difficulty="moyen" data-duration="moyen">
                    <div class="hiking-status">
                        <span class="status-badge pending">‚ö†Ô∏è En attente</span>
                    </div>
                    <div class="hiking-info">
                        <h3>La pointe des Renards</h3>
                        <p class="hiking-description">Sentier vers une pointe sauvage offrant un panorama exceptionnel
                            sur la mer d'Iroise.</p>
                        <div class="hiking-stats">
                            <span class="stat">
                                <i class="fas fa-clock"></i>
                                2h45
                            </span>
                            <span class="stat">
                                <i class="fas fa-route"></i>
                                6.8 km
                            </span>
                            <span class="stat">
                                <i class="fas fa-mountain"></i>
                                +85m
                            </span>
                            <span class="stat difficulty-moyen">
                                <i class="fas fa-signal"></i>
                                Moyen
                            </span>
                        </div>
                    </div>
                    <div class="hiking-actions">
                        <button class="btn btn-outline" onclick="showHikingMap(2)">
                            <i class="fas fa-map"></i>
                            Voir
                        </button>
                        <button class="btn btn-primary" onclick="selectHiking(2)">
                            Choisir
                        </button>
                    </div>
                </div>

                <!-- Randonn√©e 3 -->
                <div class="hiking-card" data-difficulty="facile" data-duration="court">
                    <div class="hiking-status">
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    <div class="hiking-info">
                        <h3>Le circuit de Porsmilin</h3>
                        <p class="hiking-description">Balade familiale autour de la plage de Porsmilin, id√©ale avec des
                            enfants.</p>
                        <div class="hiking-stats">
                            <span class="stat">
                                <i class="fas fa-clock"></i>
                                1h30
                            </span>
                            <span class="stat">
                                <i class="fas fa-route"></i>
                                3.2 km
                            </span>
                            <span class="stat">
                                <i class="fas fa-mountain"></i>
                                +45m
                            </span>
                            <span class="stat difficulty-facile">
                                <i class="fas fa-signal"></i>
                                Facile
                            </span>
                        </div>
                    </div>
                    <div class="hiking-actions">
                        <button class="btn btn-outline" onclick="showHikingMap(3)">
                            <i class="fas fa-map"></i>
                            Voir
                        </button>
                        <button class="btn btn-primary" onclick="selectHiking(3)">
                            Choisir
                        </button>
                    </div>
                </div>
            </div>

            <!-- Option sans randonn√©e -->
            <div class="no-hiking-option" id="noHikingCard">
                <button class="btn btn-primary no-hiking-btn" onclick="selectNoHiking()">
                    Pas de rando aujourd'hui
                </button>
            </div>
        </div>

        <div class="planning-navigation">
            <div class="navigation-buttons">
                <a href="{{ url_for('step1') }}" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i>
                    Retour √† la ville
                </a>

                <a href="{{ url_for('step3') }}" class="btn btn-primary btn-large" id="nextStepBtn"
                    style="display: none;">
                    Valider la rando et continuer
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>

    </div> <!-- .planning-content -->
</div> <!-- .main-container -->
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialiser la carte Leaflet
        const mapElement = document.getElementById('map');
        let hikeMap = null;

        if (mapElement && window.L && !mapElement._leaflet_id) {
            // Position par d√©faut (sera mise √† jour avec les donn√©es de la ville)
            hikeMap = L.map('map').setView([48.4, -4.5], 12);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(hikeMap);

            // Ajouter des marqueurs pour les randonn√©es (exemple)
            // TODO: R√©cup√©rer les vraies coordonn√©es depuis l'API
            const hikingMarkers = [
                { lat: 48.35, lon: -4.73, name: "Du Minou au Mengant" },
                { lat: 48.37, lon: -4.75, name: "La pointe des Renards" },
                { lat: 48.33, lon: -4.70, name: "Le circuit de Porsmilin" }
            ];

            hikingMarkers.forEach(marker => {
                L.marker([marker.lat, marker.lon])
                    .addTo(hikeMap)
                    .bindPopup(`<b>${marker.name}</b>`);
            });
        }

        // Gestion des filtres
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const group = this.parentElement;
                group.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // Filtrer les cartes de randonn√©es
                // TODO: Impl√©menter la logique de filtrage
            });
        });

        // Gestion de la s√©lection de randonn√©e
        window.selectHiking = function (hikingId) {
            console.log('Randonn√©e s√©lectionn√©e:', hikingId);
            // Enregistrer la s√©lection dans le localStorage
            localStorage.setItem('selectedHiking', hikingId);
            // Afficher le bouton "Continuer"
            document.getElementById('nextStepBtn').style.display = 'flex';
        };

        window.selectNoHiking = function () {
            console.log('Aucune randonn√©e s√©lectionn√©e');
            localStorage.setItem('selectedHiking', 'no-hiking');
            document.getElementById('nextStepBtn').style.display = 'flex';
        };

        window.showHikingMap = function (hikingId) {
            console.log('Afficher la carte de la randonn√©e:', hikingId);
            // TODO: Centrer la carte sur cette randonn√©e
        };
    });
</script>
{% endblock %}