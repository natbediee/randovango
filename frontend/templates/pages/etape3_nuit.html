{% extends "base.html" %}

{% set current_step = 3 %}

{% block title %}√âtape 3 - Choix de la Nuit - RandoVanGo{% endblock %}

{% block hero_subtitle %}Trouvez l'endroit parfait pour passer la nuit{% endblock %}

{% block planning_content %}
<div class="step-section">
    <div class="step-header">
        <h2>üåô Jour 1 : O√π dormir cette nuit ?</h2>
        <p>Choisissez votre h√©bergement pour terminer parfaitement cette premi√®re journ√©e</p>
    </div>

    <!-- Filtres d'h√©bergement -->
    <div class="accommodation-filters">
        <div class="filter-group">
            <label>Quand :</label>
            <button class="filter-btn active" data-filter="same-day">Le jour m√™me</button>
            <button class="filter-btn" data-filter="night-before">La veille (J-1)</button>
        </div>
        <div class="filter-group">
            <label>Type :</label>
            <button class="filter-btn active" data-filter="camping">Camping</button>
            <button class="filter-btn" data-filter="bivouac">Bivouac</button>
            <button class="filter-btn" data-filter="camping-car">Aire de camping-car</button>
        </div>
    </div>

    <!-- Spots de bivouac -->
    <div class="spots-section" id="spotsSection" style="display: none;">
        <h3>Spots disponibles pr√®s de votre randonn√©e</h3>
        <div class="spots-list">
            <!-- Spot 1 -->
            <div class="spot-card" data-type="camping-car" data-timing="same-day">
                <div class="spot-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="spot-left">
                        <span class="hiking-stats"><span class="stat">Aire de camping-car</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos bivouac -->
                    <div class="spot-center">
                        <h4>Aire CC de Plougonvelin</h4>
                        <p class="spot-description">Aire am√©nag√©e avec services complets, proche du centre-ville</p>
                        <div class="spot-features">
                            <span class="feature">üíß Eau</span>
                            <span class="feature">üöΩ WC</span>
                            <span class="feature">‚ö° √âlectricit√©</span>
                            <span class="feature">üõí Commerces 500m</span>
                        </div>
                        <div class="spot-details">
                            <span class="price">üí∞ 12‚Ç¨/nuit</span>
                            <span class="distance">üìç 2.3 km du d√©part randonn√©e</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="spot-right">
                        <button class="btn btn-outline btn-sm" onclick="showSpotMap(1)">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectSpot(1)">Choisir</button>
                    </div>
                </div>
            </div>

            <!-- Spot 2 -->
            <div class="spot-card" data-type="bivouac" data-timing="same-day">
                <div class="spot-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="spot-left">
                        <span class="hiking-stats"><span class="stat">Bivouac</span></span>
                        <span class="status-badge pending">‚ö†Ô∏è En attente</span>
                    </div>
                    
                    <!-- Colonne centre : Infos bivouac -->
                    <div class="spot-center">
                        <h4>Parking Fort de Bertheaume</h4>
                        <p class="spot-description">Vue exceptionnelle sur le fort, mais sans services</p>
                        <div class="spot-features">
                            <span class="feature disabled">‚ùå Pas d'eau</span>
                            <span class="feature disabled">‚ùå Pas de WC</span>
                            <span class="feature">üåÖ Vue mer</span>
                            <span class="feature">üì∏ Tr√®s photog√©nique</span>
                        </div>
                        <div class="spot-details">
                            <span class="price">üí∞ Gratuit</span>
                            <span class="distance">üìç 1.8 km du d√©part randonn√©e</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="spot-right">
                        <button class="btn btn-outline btn-sm" onclick="showSpotMap(2)">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectSpot(2)">Choisir</button>
                    </div>
                </div>
            </div>

            <!-- Spot 3 -->
            <div class="spot-card" data-type="camping" data-timing="same-day">
                <div class="spot-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="spot-left">
                        <span class="hiking-stats"><span class="stat">Camping</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos bivouac -->
                    <div class="spot-center">
                        <h4>Camping de Porsmilin</h4>
                        <p class="spot-description">Camping familial face √† la plage, sanitaires propres</p>
                        <div class="spot-features">
                            <span class="feature">üíß Eau chaude</span>
                            <span class="feature">üöø Douches</span>
                            <span class="feature">üèñÔ∏è Acc√®s plage</span>
                            <span class="feature">ü•ê D√©p√¥t pain</span>
                        </div>
                        <div class="spot-details">
                            <span class="price">üí∞ 18‚Ç¨/nuit</span>
                            <span class="distance">üìç 3.1 km du d√©part randonn√©e</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="spot-right">
                        <button class="btn btn-outline btn-sm" onclick="showSpotMap(3)">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectSpot(3)">Choisir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Option h√©bergement personnel -->
    <div class="no-spot-option" id="noSpotCard">
        <button class="btn btn-primary no-spot-btn" onclick="selectNoSpot()">
            Autre h√©bergement (ami, h√¥tel, chez soi...)
        </button>
    </div>
</div>
{% endblock %}

{% block navigation %}
<div class="navigation-buttons">
    <a href="{{ url_for('planificateur_etape2') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        √âtape pr√©c√©dente
    </a>
    
    <a href="{{ url_for('planificateur_etape4') }}" class="btn btn-primary btn-large" id="nextStepBtn" style="display: none;">
        √âtape suivante : Services
        <i class="fas fa-arrow-right"></i>
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
// Gestion des filtres d'h√©bergement
document.addEventListener('DOMContentLoaded', function() {
    // Adapter le contenu si pas de randonn√©e
    const selectedHiking = localStorage.getItem('selectedHiking');
    if (selectedHiking === 'no-hiking') {
        const stepHeader = document.querySelector('.step-header p');
        stepHeader.textContent = 'Choisissez votre h√©bergement pour cette journ√©e d√©tente et d√©couverte';
        
        const stepTitle = document.querySelector('.step-header h2');
        stepTitle.textContent = 'üåô Jour 1 : O√π dormir apr√®s cette journ√©e d√©tente ?';
    }
    
    const filterBtns = document.querySelectorAll('.filter-btn');
    const spotCards = document.querySelectorAll('.spot-card');
    
    // Gestion des filtres
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Retirer active de tous les boutons du m√™me groupe
            const group = this.parentElement;
            group.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Afficher la section des spots si un filtre sp√©cifique est s√©lectionn√©
            const filterValue = this.getAttribute('data-filter');
            if (filterValue !== 'all') {
                document.getElementById('spotsSection').style.display = 'block';
            }
        });
    });
    
    // Auto-afficher les spots
    document.getElementById('spotsSection').style.display = 'block';
});

function selectSpot(spotId) {
    // Marquer le spot comme s√©lectionn√©
    document.querySelectorAll('.spot-card').forEach(card => card.classList.remove('selected'));
    document.querySelector(`[onclick="selectSpot(${spotId})"]`).closest('.spot-card').classList.add('selected');
    
    // D√©s√©lectionner l'option "autre h√©bergement"
    const noSpotOption = document.querySelector('.no-spot-option');
    if (noSpotOption) {
        noSpotOption.classList.remove('selected');
    }
    
    // Sauvegarder le choix dans localStorage
    localStorage.setItem('selectedSpot', spotId);
    
    // Afficher la m√©t√©o nocturne
    const nightWeather = document.getElementById('nightWeather');
    if (nightWeather) {
        nightWeather.style.display = 'block';
    }
    
    // Afficher le bouton suivant
    const nextBtn = document.getElementById('nextStepBtn');
    if (nextBtn) {
        nextBtn.style.display = 'block';
    }
}

function selectNoSpot() {
    // D√©s√©lectionner tous les spots
    document.querySelectorAll('.spot-card').forEach(card => card.classList.remove('selected'));
    
    // Marquer l'option "autre h√©bergement" comme s√©lectionn√©e
    const noSpotOption = document.querySelector('.no-spot-option');
    if (noSpotOption) {
        noSpotOption.classList.add('selected');
    }
    
    // Sauvegarder le choix dans localStorage
    localStorage.setItem('selectedSpot', 'autre_hebergement');
    
    // Masquer la m√©t√©o nocturne (pas n√©cessaire pour un h√©bergement alternatif)
    const nightWeather = document.getElementById('nightWeather');
    if (nightWeather) {
        nightWeather.style.display = 'none';
    }
    
    // Afficher le bouton suivant
    const nextBtn = document.getElementById('nextStepBtn');
    if (nextBtn) {
        nextBtn.style.display = 'block';
    }
}

function showSpotMap(spotId) {
    // Ouvrir la vue cartographique avec la randonn√©e choisie + l'emplacement du bivouac
    const selectedHiking = localStorage.getItem('selectedHiking') || '1';
    const mapUrl = `/map/spot/${spotId}?hiking=${selectedHiking}`;
    window.open(mapUrl, '_blank', 'width=1200,height=800');
}
</script>
{% endblock %}