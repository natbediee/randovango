{% extends "base.html" %}

{% block title %}R√©sultat - Votre Plan Van Life - RandoVanGo{% endblock %}

{% block page_content %}
<div class="main-container">
    <div class="page-header">
        <div class="hero-section">
            <img src="{{ url_for('static', filename='images/van-life-liberte.jpg') }}" alt="Planificateur Van Life" class="hero-background">
            <div class="hero-overlay"></div>
            <div class="hero-logo-container">
                <div class="hero-logo-white">
                    <img src="{{ url_for('static', filename='images/logo_randovango.png') }}" alt="RandoVanGo" class="hero-logo-img">
                </div>
            </div>
            <div class="hero-content">
                <h1 class="hero-title">Planificateur RandoVanGo</h1>
                <p class="hero-subtitle">S√©lectionnez votre randonn√©e pr√©f√©r√©e</p>
            </div>
        </div>
    </div>
    
    <div class="planning-stepper">
        <div class="stepper-container">
            <div class="step completed">
                <div class="step-circle">‚úì</div>
                <div class="step-label">Ville</div>
            </div>
            <div class="step-line completed"></div>
            <div class="step active">
                <div class="step-circle">2</div>
                <div class="step-label">Randonn√©e</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">3</div>
                <div class="step-label">Nuit</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">4</div>
                <div class="step-label">Services</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-circle">üìã</div>
                <div class="step-label">R√©sultat</div>
            </div>
        </div>
    </div>
<div class="step-section">
    <div class="step-header">
        <h2>üìã R√©capitulatif du voyage</h2>
    </div>

    <!-- Tableau r√©capitulatif -->
    <div class="plan-table">
        <table class="results-table">
            <thead>
                <tr>
                    <th>Jour</th>
                    <th>Ville</th>
                    <th>Activit√©</th>
                    <th>H√©bergement</th>
                    <th>Services</th>
                </tr>
            </thead>
            <tbody>
                <tr id="day1-row">
                    <td><strong>Jour 1</strong></td>
                    <td id="city-cell">Plougonvelin</td>
                    <td id="activity-cell">Randonn√©e s√©lectionn√©e</td>
                    <td id="accommodation-cell">Spot s√©lectionn√©</td>
                    <td id="services-cell">Services s√©lectionn√©s</td>
                </tr>
                <!-- Les autres jours seront ajout√©s ici -->
            </tbody>
        </table>
    </div>
</div>
<!-- Carte interactive -->
    <div class="map-page-container" style="margin: 2rem 0;">
        <h3 class="map-title">Visualisation sur la carte</h3>
        <div id="map" style="height: 40vh; width: 100%; border-radius: 12px; box-shadow: 0 2px 8px #0002;"></div>
    </div>

<div class="planning-navigation">
<div class="navigation-buttons">
    <a href="{{ url_for('step4') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        √âtape pr√©c√©dente
    </a>
    
    <button class="btn btn-primary btn-large" onclick="planifierJour2()">
        <i class="fas fa-plus-circle"></i>
        Planifier jour 2
    </button>
</div>
</div>

</div>
{% endblock %}

{% block scripts %}
<style>
.results-table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    background: var(--white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow);
}

.results-table th,
.results-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--gray-200);
}

.results-table th {
    background: var(--blue);
    color: var(--white);
    font-weight: 600;
}

.results-table tr:hover {
    background: var(--gray-50);
}

.plan-table {
    margin: 2rem 0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialiser la carte Leaflet
    const mapElement = document.getElementById('map');
    let resultMap = null;

    if (mapElement && window.L && !mapElement._leaflet_id) {
        resultMap = L.map('map').setView([48.4, -4.5], 11);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(resultMap);
        
        // Ajouter tous les marqueurs (randonn√©e + spot + services)
        const allMarkers = [
            { lat: 48.35, lon: -4.73, name: "Randonn√©e", color: 'blue' },
            { lat: 48.36, lon: -4.72, name: "H√©bergement", color: 'green' },
            { lat: 48.38, lon: -4.73, name: "Services", color: 'orange' }
        ];
        
        allMarkers.forEach(marker => {
            L.marker([marker.lat, marker.lon])
                .addTo(resultMap)
                .bindPopup(`<b>${marker.name}</b>`);
        });
    }

    // R√©cup√©rer les s√©lections depuis localStorage
    const selectedHiking = localStorage.getItem('selectedHiking');
    const selectedSpot = localStorage.getItem('selectedSpot');
    const selectedServices = localStorage.getItem('selectedServices');
    
    // Remplir les cellules du tableau
    const activityCell = document.getElementById('activity-cell');
    const accommodationCell = document.getElementById('accommodation-cell');
    const servicesCell = document.getElementById('services-cell');
    
    // Activit√©
    if (selectedHiking === 'no-hiking') {
        activityCell.textContent = 'Pas de randonn√©e - D√©tente';
    } else if (selectedHiking) {
        activityCell.textContent = `Randonn√©e ${selectedHiking}`;
    } else {
        activityCell.textContent = 'Randonn√©e s√©lectionn√©e';
    }
    
    // H√©bergement
    if (selectedSpot === 'autre_hebergement') {
        accommodationCell.textContent = 'Autre h√©bergement';
    } else if (selectedSpot) {
        accommodationCell.textContent = `Spot ${selectedSpot}`;
    } else {
        accommodationCell.textContent = 'Spot s√©lectionn√©';
    }
    
    // Services
    if (selectedServices === 'aucun_service') {
        servicesCell.textContent = 'Aucun service';
    } else if (selectedServices) {
        servicesCell.textContent = selectedServices;
    } else {
        servicesCell.textContent = 'Services s√©lectionn√©s';
    }
});

function planifierJour2() {
    // Sauvegarder que le jour 1 est termin√©
    localStorage.setItem('completed_days', '1');
    
    // Rediriger vers l'√©tape 1 pour planifier le jour 2
    window.location.href = '/step2';
}
</script>
{% endblock %}