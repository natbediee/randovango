{% extends "base.html" %}

{% set current_step = 4 %}

{% block title %}√âtape 4 - Services et POI - RandoVanGo{% endblock %}

{% block hero_subtitle %}Ajoutez les services essentiels √† votre voyage{% endblock %}

{% block planning_content %}
<div class="step-section">
    <div class="step-header">
        <h2>üõ†Ô∏è Jour 1 : Services pour compl√©ter votre journ√©e</h2>
        <p>Ajoutez les commerces et √©quipements utiles pour r√©ussir cette premi√®re journ√©e</p>
    </div>

    <!-- Cat√©gories de services -->
    <div class="services-categories">
        <div class="category-tabs">
            <button class="category-tab active" data-category="logistique">
                <i class="fas fa-shopping-cart"></i>
                Logistique
            </button>
            <button class="category-tab" data-category="hygiene">
                <i class="fas fa-shower"></i>
                Hygi√®ne
            </button>
            <button class="category-tab" data-category="culture">
                <i class="fas fa-camera"></i>
                Culture & Loisirs
            </button>
            <button class="category-tab" data-category="urgence">
                <i class="fas fa-first-aid"></i>
                Urgences
            </button>
        </div>

        <!-- Services Logistique -->
        <div class="services-grid" id="logistique" style="display: block;">
            <div class="service-card" data-type="courses">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">Courses</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Super U Le Conquet</h4>
                        <p>Supermarch√© complet avec produits frais</p>
                        <div class="service-details">
                            <span class="distance">üìç 2.5 km</span>
                            <span class="hours">üïê 8h-20h</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm" onclick="showServiceDetails('super-u')">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectService('super-u')">Ajouter</button>
                    </div>
                </div>
            </div>

                        <div class="service-card" data-type="eau">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">Point d'eau</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Point d'eau potable</h4>
                        <p>Fontaine publique - Gratuit</p>
                        <div class="service-details">
                            <span class="distance">üìç 800m</span>
                            <span class="hours">üïê 24h/24</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm" onclick="showServiceDetails('fontaine')">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectService('fontaine')">Ajouter</button>
                    </div>
                </div>
            </div>

                        <div class="service-card" data-type="carburant">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">Carburant</span></span>
                        <span class="status-badge pending">‚ö†Ô∏è En attente</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Station Total Access</h4>
                        <p>Station-service automatique</p>
                        <div class="service-details">
                            <span class="distance">üìç 3.2 km</span>
                            <span class="hours">üïê 24h/24</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm" onclick="showServiceDetails('station')">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="selectService('carburant')">Ajouter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Hygi√®ne -->
        <div class="services-grid" id="hygiene" style="display: none;">
            <div class="service-card" data-type="wc">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">WC Public</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>WC Publics Port</h4>
                        <p>Toilettes publiques propres</p>
                        <div class="service-details">
                            <span class="distance">üìç 1.2 km</span>
                            <span class="hours">üïê 6h-22h</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm">Ajouter</button>
                    </div>
                </div>
            </div>

            <div class="service-card" data-type="douche">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">Douches</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Douches Camping</h4>
                        <p>Acc√®s douches chaudes payantes</p>
                        <div class="service-details">
                            <span class="distance">üìç 3.1 km</span>
                            <span class="price">üí∞ 3‚Ç¨</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm">Ajouter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Culture -->
        <div class="services-grid" id="culture" style="display: none;">
            <div class="service-card" data-type="patrimoine">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">Patrimoine</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Fort de Bertheaume</h4>
                        <p>Monument historique √† visiter</p>
                        <div class="service-details">
                            <span class="distance">üìç 1.8 km</span>
                            <span class="price">üí∞ Gratuit</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm">Ajouter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Urgences -->
        <div class="services-grid" id="urgence" style="display: none;">
            <div class="service-card" data-type="medecin">
                <div class="service-content-grid">
                    <!-- Colonne gauche : Type + V√©rifi√© -->
                    <div class="service-left">
                        <span class="hiking-stats"><span class="stat">M√©decin</span></span>
                        <span class="status-badge verified">‚úÖ V√©rifi√©</span>
                    </div>
                    
                    <!-- Colonne centre : Infos service -->
                    <div class="service-center">
                        <h4>Cabinet M√©dical</h4>
                        <p>M√©decin g√©n√©raliste</p>
                        <div class="service-details">
                            <span class="distance">üìç 2.8 km</span>
                            <span class="phone">üìû 02.98.xx.xx.xx</span>
                        </div>
                    </div>
                    
                    <!-- Colonne droite : Boutons -->
                    <div class="service-right">
                        <button class="btn btn-outline btn-sm">
                            <i class="fas fa-map"></i> Voir
                        </button>
                        <button class="btn btn-primary btn-sm">Ajouter</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Services s√©lectionn√©s -->
    <div class="selected-services" id="selectedServices" style="display: none;">
        <h3>üìã Services ajout√©s au Jour 1</h3>
        <div class="selected-list" id="selectedList">
            <!-- Les services s√©lectionn√©s appara√Ætront ici -->
        </div>
    </div>

    <!-- Option "Aucun service" -->
    <div class="no-service-option" onclick="selectNoService()">
        <button class="btn btn-primary">
            üö´ Aucun service n√©cessaire
        </button>
    </div>
</div>
{% endblock %}

{% block navigation %}
<div class="navigation-buttons">
    <a href="{{ url_for('planificateur_etape3') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        √âtape pr√©c√©dente
    </a>
    
    <a href="{{ url_for('planificateur_resultat') }}" class="btn btn-primary btn-large" id="nextStepBtn" style="display: none;">
        Voir jour 1
        <i class="fas fa-check-circle"></i>
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
// JavaScript pour la gestion des services
document.addEventListener('DOMContentLoaded', function() {
    // Adapter le contenu selon les choix pr√©c√©dents
    const selectedHiking = localStorage.getItem('selectedHiking');
    const selectedSpot = localStorage.getItem('selectedSpot');
    
    if (selectedHiking === 'no-hiking') {
        const stepTitle = document.querySelector('.step-header h2');
        stepTitle.textContent = 'üõ†Ô∏è Jour 1 : Services pour votre journ√©e d√©tente';
    }
    
    if (selectedSpot === 'autre_hebergement') {
        const stepSubtitle = document.querySelector('.step-header p');
        stepSubtitle.textContent = 'Ajoutez les services utiles pendant votre s√©jour';
    }
    
    const categoryTabs = document.querySelectorAll('.category-tab');
    const serviceGrids = document.querySelectorAll('.services-grid');
    let selectedServices = [];
    
    // Gestion des onglets
    categoryTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // Mettre √† jour les onglets
            categoryTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Afficher la bonne grille
            serviceGrids.forEach(grid => {
                grid.style.display = grid.id === category ? 'block' : 'none';
            });
        });
    });
});

function selectService(serviceId) {
    // D√©s√©lectionner l'option "aucun service"
    const noServiceOption = document.querySelector('.no-service-option');
    if (noServiceOption) {
        noServiceOption.classList.remove('selected');
    }
    
    // Ajouter le service √† la liste
    const selectedServices = document.getElementById('selectedServices');
    const selectedList = document.getElementById('selectedList');
    const nextBtn = document.getElementById('nextStepBtn');
    
    // Cr√©er l'√©l√©ment service s√©lectionn√©
    const serviceElement = document.createElement('div');
    serviceElement.className = 'selected-service-item';
    serviceElement.innerHTML = `
        <span class="service-name">‚úÖ ${serviceId}</span>
        <button class="btn btn-outline btn-sm" onclick="removeService('${serviceId}')">Retirer</button>
    `;
    
    selectedList.appendChild(serviceElement);
    selectedServices.style.display = 'block';
    nextBtn.style.display = 'block';
}

function removeService(serviceId) {
    // Retirer le service (√† impl√©menter)
    console.log('Retirer service:', serviceId);
}

function selectNoService() {
    // Marquer l'option "aucun service" comme s√©lectionn√©e
    const noServiceOption = document.querySelector('.no-service-option');
    noServiceOption.classList.add('selected');
    
    // Vider la liste des services s√©lectionn√©s
    const selectedList = document.getElementById('selectedList');
    const selectedServices = document.getElementById('selectedServices');
    selectedList.innerHTML = '';
    selectedServices.style.display = 'none';
    
    // Sauvegarder le choix dans localStorage
    localStorage.setItem('selectedServices', 'aucun_service');
    
    // Afficher le bouton suivant
    document.getElementById('nextStepBtn').style.display = 'block';
}

function showServiceDetails(serviceId) {
    alert('D√©tails du service: ' + serviceId + ' (Modal √† impl√©menter)');
}
</script>
{% endblock %}